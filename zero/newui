local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local TextService = game:GetService("TextService")

local ModernUI = {}
ModernUI.__index = ModernUI

local ICONS = {
    home = "rbxassetid://101875856455207",
    settings = "rbxassetid://98599119688886",
    waves = "rbxassetid://87625851043073",
    notify = "rbxassetid://85115471197192",
    discord = "rbxassetid://97154802041062",
    cart = "rbxassetid://113141218821629"
}

local THEMES = {
    White = Color3.fromRGB(255, 255, 255),
    Red = Color3.fromRGB(255, 70, 70),
    Purple = Color3.fromRGB(170, 100, 255),
    Yellow = Color3.fromRGB(255, 220, 70),
    Green = Color3.fromRGB(70, 255, 150),
    Blue = Color3.fromRGB(70, 150, 255)
}

local COLORS = {
    Background = Color3.fromRGB(15, 15, 20),
    Surface = Color3.fromRGB(20, 20, 28),
    SurfaceLight = Color3.fromRGB(25, 25, 34),
    Border = Color3.fromRGB(40, 40, 50),
    White = Color3.fromRGB(255, 255, 255),
    Gray = Color3.fromRGB(160, 160, 170),
    DarkGray = Color3.fromRGB(100, 100, 110),
    Icon = Color3.fromRGB(200, 200, 210),
    Accent = Color3.fromRGB(255, 255, 255)
}

local TWEEN_INFO = TweenInfo.new(0.25, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
local FAST_TWEEN = TweenInfo.new(0.15, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
local SLOW_TWEEN = TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)

local function CreateImageBackground(parent, imageId, transparency)
    local bg = Instance.new("ImageLabel")
    bg.Name = "CustomBackground"
    bg.Size = UDim2.new(1, 0, 1, 0)
    bg.Position = UDim2.new(0, 0, 0, 0)
    bg.BackgroundTransparency = 1
    bg.Image = imageId or ""
    bg.ImageTransparency = transparency or 0.3
    bg.ScaleType = Enum.ScaleType.Crop
    bg.ZIndex = 0
    bg.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = bg
    
    return bg
end

local function AnimateIcon(imageLabel, frames, fps)
    if type(frames) == "string" then
        imageLabel.Image = frames
        return
    elseif type(frames) == "table" then
        task.spawn(function()
            local currentFrame = 1
            while imageLabel and imageLabel.Parent do
                imageLabel.Image = frames[currentFrame]
                currentFrame = currentFrame % #frames + 1
                task.wait(fps or 0.1)
            end
        end)
    else
        imageLabel.Image = ICONS.home
    end
end

local function PlaySound(soundId)
    if not game:GetService("SoundService").RespectFilteringEnabled then
        local sound = Instance.new("Sound")
        sound.SoundId = soundId
        sound.Parent = workspace
        sound:Play()
        game:GetService("Debris"):AddItem(sound, 2)
    end
end

function ModernUI.new(config)
    local self = setmetatable({}, ModernUI)
    
    config = config or {}
    self.Title = config.Title or "Modern UI"
    self.SubTitle = config.SubTitle or "Library"
    self.Icon = config.Icon or ICONS.home
    self.IconFPS = config.IconFPS or 0.1
    self.MinimizeKey = Enum.KeyCode.LeftControl
    self.SaveFolder = "ModernUIConfig"
    self.AcrylicEnabled = false
    self.CurrentTheme = "White"
    self.BackgroundImage = ""
    self.BackgroundTransparency = 0.3
    self.CustomThemes = {}
    self.SoundsEnabled = true
    self.AnimationsEnabled = true
    self.RoundedCorners = true
    self.TabPosition = "Left"
    
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "ModernUILibrary"
    self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.ScreenGui.ResetOnSpawn = false
    self.ScreenGui.DisplayOrder = 999
    
    local screenSize = workspace.CurrentCamera.ViewportSize
    local isMobile = screenSize.X < 600
    
    local width = isMobile and screenSize.X * 0.9 or 550
    local height = isMobile and screenSize.Y * 0.7 or 440
    
    self.MainFrame = Instance.new("Frame")
    self.MainFrame.Name = "MainFrame"
    self.MainFrame.Size = UDim2.new(0, width, 0, height)
    self.MainFrame.Position = UDim2.new(0.5, -width/2, 0.5, -height/2)
    self.MainFrame.BackgroundColor3 = COLORS.Background
    self.MainFrame.BorderSizePixel = 0
    self.MainFrame.Parent = self.ScreenGui
    self.MainFrame.Active = true
    self.MainFrame.ClipsDescendants = true
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = self.MainFrame
    
    self.CustomBg = CreateImageBackground(self.MainFrame, "", 1)
    
    local Shadow = Instance.new("ImageLabel")
    Shadow.Name = "Shadow"
    Shadow.Size = UDim2.new(1, 32, 1, 32)
    Shadow.Position = UDim2.new(0, -16, 0, -16)
    Shadow.BackgroundTransparency = 1
    Shadow.Image = "rbxassetid://5554236805"
    Shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
    Shadow.ImageTransparency = 0.6
    Shadow.ScaleType = Enum.ScaleType.Slice
    Shadow.SliceCenter = Rect.new(23, 23, 277, 277)
    Shadow.ZIndex = 0
    Shadow.Parent = self.MainFrame
    
    self:CreateHeader()
    self:CreateSidebar()
    self:CreateContentArea()
    self:MakeDraggable(self.MainFrame, self.MainFrame:FindFirstChild("Header"))
    self:MakeResizable()
    self:SetupMinimizeKey()
    
    self.Tabs = {}
    self.CurrentTab = nil
    self.ConfigData = {
        Toggles = {},
        Dropdowns = {},
        MultiDropdowns = {},
        Sliders = {},
        FloatingButton = {},
        CustomThemes = {}
    }
    self.AccentElements = {}
    
    self.ScreenGui.Parent = game:GetService("CoreGui")
    
    self:LoadConfig()
    self:ApplyTheme(self.CurrentTheme)
    self:ApplyAcrylic(self.AcrylicEnabled)
    
    if self.BackgroundImage ~= "" then
        self:ApplyBackgroundImage(self.BackgroundImage, self.BackgroundTransparency)
    end
    
    if config.FloatingButton ~= false then
        local floatingConfig = config.FloatingButton or {}
        if not floatingConfig.Icon then
            floatingConfig.Icon = self.Icon
        end
        self:CreateFloatingButton(floatingConfig)
    end
    
    return self
end

function ModernUI:CreateColorPicker(parent, currentColor, callback)
    local ColorPickerFrame = Instance.new("Frame")
    ColorPickerFrame.Size = UDim2.new(1, 0, 0, 200)
    ColorPickerFrame.BackgroundColor3 = COLORS.Background
    ColorPickerFrame.BorderSizePixel = 0
    ColorPickerFrame.ZIndex = 11
    ColorPickerFrame.Parent = parent
    
    local CPCorner = Instance.new("UICorner")
    CPCorner.CornerRadius = UDim.new(0, 10)
    CPCorner.Parent = ColorPickerFrame
    
    local ColorCanvas = Instance.new("ImageButton")
    ColorCanvas.Size = UDim2.new(1, -120, 1, -16)
    ColorCanvas.Position = UDim2.new(0, 8, 0, 8)
    ColorCanvas.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ColorCanvas.BorderSizePixel = 0
    ColorCanvas.ZIndex = 11
    ColorCanvas.AutoButtonColor = false
    ColorCanvas.Parent = ColorPickerFrame
    
    local CanvasCorner = Instance.new("UICorner")
    CanvasCorner.CornerRadius = UDim.new(0, 8)
    CanvasCorner.Parent = ColorCanvas
    
    local CanvasGradient = Instance.new("UIGradient")
    CanvasGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 0, 0))
    })
    CanvasGradient.Rotation = 90
    CanvasGradient.Parent = ColorCanvas
    
    local HueSlider = Instance.new("Frame")
    HueSlider.Size = UDim2.new(0, 24, 1, -16)
    HueSlider.Position = UDim2.new(1, -32, 0, 8)
    HueSlider.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    HueSlider.BorderSizePixel = 0
    HueSlider.ZIndex = 11
    HueSlider.Parent = ColorPickerFrame
    
    local HueCorner = Instance.new("UICorner")
    HueCorner.CornerRadius = UDim.new(0, 8)
    HueCorner.Parent = HueSlider
    
    local HueGradient = Instance.new("UIGradient")
    HueGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
        ColorSequenceKeypoint.new(0.17, Color3.fromRGB(255, 255, 0)),
        ColorSequenceKeypoint.new(0.33, Color3.fromRGB(0, 255, 0)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
        ColorSequenceKeypoint.new(0.67, Color3.fromRGB(0, 0, 255)),
        ColorSequenceKeypoint.new(0.83, Color3.fromRGB(255, 0, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
    })
    HueGradient.Rotation = 90
    HueGradient.Parent = HueSlider
    
    local HueButton = Instance.new("TextButton")
    HueButton.Size = UDim2.new(1, 0, 1, 0)
    HueButton.BackgroundTransparency = 1
    HueButton.Text = ""
    HueButton.ZIndex = 11
    HueButton.Parent = HueSlider
    
    local HueIndicator = Instance.new("Frame")
    HueIndicator.Size = UDim2.new(1, 4, 0, 4)
    HueIndicator.Position = UDim2.new(0, -2, 0, 0)
    HueIndicator.BackgroundColor3 = COLORS.White
    HueIndicator.BorderSizePixel = 0
    HueIndicator.ZIndex = 12
    HueIndicator.Parent = HueSlider
    
    local HueIndCorner = Instance.new("UICorner")
    HueIndCorner.CornerRadius = UDim.new(1, 0)
    HueIndCorner.Parent = HueIndicator
    
    local ColorIndicator = Instance.new("Frame")
    ColorIndicator.Size = UDim2.new(0, 12, 0, 12)
    ColorIndicator.Position = UDim2.new(1, -6, 0, -6)
    ColorIndicator.BackgroundColor3 = COLORS.White
    ColorIndicator.BorderSizePixel = 2
    ColorIndicator.BorderColor3 = Color3.fromRGB(0, 0, 0)
    ColorIndicator.ZIndex = 12
    ColorIndicator.Parent = ColorCanvas
    
    local ColorIndCorner = Instance.new("UICorner")
    ColorIndCorner.CornerRadius = UDim.new(1, 0)
    ColorIndCorner.Parent = ColorIndicator
    
    local Preview = Instance.new("Frame")
    Preview.Size = UDim2.new(0, 80, 0, 32)
    Preview.Position = UDim2.new(1, -88, 1, -40)
    Preview.BackgroundColor3 = currentColor or Color3.fromRGB(255, 255, 255)
    Preview.BorderSizePixel = 0
    Preview.ZIndex = 11
    Preview.Parent = ColorPickerFrame
    
    local PreviewCorner = Instance.new("UICorner")
    PreviewCorner.CornerRadius = UDim.new(0, 8)
    PreviewCorner.Parent = Preview
    
    local hue = 0
    local sat = 1
    local val = 1
    
    local draggingHue = false
    local draggingColor = false
    
    local function updateColor()
        local baseColor = Color3.fromHSV(hue, 1, 1)
        ColorCanvas.BackgroundColor3 = baseColor
        
        local finalColor = Color3.fromHSV(hue, sat, val)
        Preview.BackgroundColor3 = finalColor
        
        if callback then
            callback(finalColor)
        end
    end
    
    HueButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingHue = true
            local relativeY = math.clamp(input.Position.Y - HueSlider.AbsolutePosition.Y, 0, HueSlider.AbsoluteSize.Y)
            local percent = relativeY / HueSlider.AbsoluteSize.Y
            hue = percent
            HueIndicator.Position = UDim2.new(0, -2, percent, -2)
            updateColor()
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if draggingHue and input.UserInputType == Enum.UserInputType.MouseMovement then
            local relativeY = math.clamp(input.Position.Y - HueSlider.AbsolutePosition.Y, 0, HueSlider.AbsoluteSize.Y)
            local percent = relativeY / HueSlider.AbsoluteSize.Y
            hue = percent
            HueIndicator.Position = UDim2.new(0, -2, percent, -2)
            updateColor()
        end
        
        if draggingColor and input.UserInputType == Enum.UserInputType.MouseMovement then
            local relativeX = math.clamp(input.Position.X - ColorCanvas.AbsolutePosition.X, 0, ColorCanvas.AbsoluteSize.X)
            local relativeY = math.clamp(input.Position.Y - ColorCanvas.AbsolutePosition.Y, 0, ColorCanvas.AbsoluteSize.Y)
            sat = relativeX / ColorCanvas.AbsoluteSize.X
            val = 1 - (relativeY / ColorCanvas.AbsoluteSize.Y)
            ColorIndicator.Position = UDim2.new(sat, -6, 1 - val, -6)
            updateColor()
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingHue = false
            draggingColor = false
        end
    end)
    
    ColorCanvas.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingColor = true
            local relativeX = math.clamp(input.Position.X - ColorCanvas.AbsolutePosition.X, 0, ColorCanvas.AbsoluteSize.X)
            local relativeY = math.clamp(input.Position.Y - ColorCanvas.AbsolutePosition.Y, 0, ColorCanvas.AbsoluteSize.Y)
            sat = relativeX / ColorCanvas.AbsoluteSize.X
            val = 1 - (relativeY / ColorCanvas.AbsoluteSize.Y)
            ColorIndicator.Position = UDim2.new(sat, -6, 1 - val, -6)
            updateColor()
        end
    end)
    
    return ColorPickerFrame
end

function ModernUI:ShowSettingsWindow()
    if self.SettingsWindow and self.SettingsWindow.Parent then
        self.SettingsWindow:Destroy()
    end
    
    local Overlay = Instance.new("Frame")
    Overlay.Name = "SettingsOverlay"
    Overlay.Size = UDim2.new(1, 0, 1, 0)
    Overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Overlay.BackgroundTransparency = 1
    Overlay.BorderSizePixel = 0
    Overlay.ZIndex = 10
    Overlay.Parent = self.MainFrame
    
    local Settings = Instance.new("Frame")
    Settings.Name = "Settings"
    Settings.Size = UDim2.new(0, 280, 1, 0)
    Settings.Position = UDim2.new(1, 0, 0, 0)
    Settings.BackgroundColor3 = COLORS.Surface
    Settings.BorderSizePixel = 0
    Settings.ZIndex = 11
    Settings.Parent = Overlay
    
    local SettingsCorner = Instance.new("UICorner")
    SettingsCorner.CornerRadius = UDim.new(0, 12)
    SettingsCorner.Parent = Settings
    
    self.SettingsWindow = Settings
    
    TweenService:Create(Overlay, FAST_TWEEN, {BackgroundTransparency = 0.4}):Play()
    TweenService:Create(Settings, TWEEN_INFO, {Position = UDim2.new(1, -280, 0, 0)}):Play()
    
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 45)
    Header.BackgroundTransparency = 1
    Header.ZIndex = 11
    Header.Parent = Settings
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, -50, 1, 0)
    Title.Position = UDim2.new(0, 16, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "Settings"
    Title.TextColor3 = COLORS.White
    Title.TextSize = 14
    Title.Font = Enum.Font.GothamBold
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.ZIndex = 11
    Title.Parent = Header
    
    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Size = UDim2.new(0, 28, 0, 28)
    CloseBtn.Position = UDim2.new(1, -36, 0.5, -14)
    CloseBtn.BackgroundColor3 = COLORS.Background
    CloseBtn.Text = ""
    CloseBtn.AutoButtonColor = false
    CloseBtn.ZIndex = 11
    CloseBtn.Parent = Header
    
    local CloseBtnCorner = Instance.new("UICorner")
    CloseBtnCorner.CornerRadius = UDim.new(0, 7)
    CloseBtnCorner.Parent = CloseBtn
    
    local CloseIcon = Instance.new("ImageLabel")
    CloseIcon.Size = UDim2.new(0, 12, 0, 12)
    CloseIcon.Position = UDim2.new(0.5, -6, 0.5, -6)
    CloseIcon.BackgroundTransparency = 1
    CloseIcon.Image = ICONS.home
    CloseIcon.ImageColor3 = COLORS.Icon
    CloseIcon.ZIndex = 11
    CloseIcon.Parent = CloseBtn
    
    CloseBtn.MouseButton1Click:Connect(function()
        TweenService:Create(Settings, TWEEN_INFO, {Position = UDim2.new(1, 0, 0, 0)}):Play()
        TweenService:Create(Overlay, FAST_TWEEN, {BackgroundTransparency = 1}):Play()
        wait(0.3)
        Overlay:Destroy()
    end)
    
    local Content = Instance.new("ScrollingFrame")
    Content.Size = UDim2.new(1, -32, 1, -95)
    Content.Position = UDim2.new(0, 16, 0, 52)
    Content.BackgroundTransparency = 1
    Content.BorderSizePixel = 0
    Content.ScrollBarThickness = 3
    Content.ScrollBarImageColor3 = COLORS.Border
    Content.CanvasSize = UDim2.new(0, 0, 0, 0)
    Content.ZIndex = 11
    Content.Parent = Settings
    
    local ContentLayout = Instance.new("UIListLayout")
    ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ContentLayout.Padding = UDim.new(0, 12)
    ContentLayout.Parent = Content
    
    ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Content.CanvasSize = UDim2.new(0, 0, 0, ContentLayout.AbsoluteContentSize.Y + 16)
    end)
    
    local function CreateSettingLabel(text, layoutOrder)
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, 0, 0, 18)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = COLORS.White
        label.TextSize = 11
        label.Font = Enum.Font.GothamBold
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 11
        label.LayoutOrder = layoutOrder
        label.Parent = Content
        return label
    end
    
    local function CreateToggleSetting(name, currentValue, callback, layoutOrder)
        local toggleFrame = Instance.new("Frame")
        toggleFrame.Size = UDim2.new(1, 0, 0, 36)
        toggleFrame.BackgroundColor3 = COLORS.Background
        toggleFrame.BorderSizePixel = 0
        toggleFrame.ZIndex = 11
        toggleFrame.LayoutOrder = layoutOrder
        toggleFrame.Parent = Content
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = toggleFrame
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.65, 0, 1, 0)
        label.Position = UDim2.new(0, 12, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = name
        label.TextColor3 = COLORS.White
        label.TextSize = 11
        label.Font = Enum.Font.GothamMedium
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 11
        label.Parent = toggleFrame
        
        local toggleBtn = Instance.new("TextButton")
        toggleBtn.Size = UDim2.new(0, 38, 0, 20)
        toggleBtn.Position = UDim2.new(1, -46, 0.5, -10)
        toggleBtn.BackgroundColor3 = currentValue and COLORS.Accent or COLORS.SurfaceLight
        toggleBtn.BorderSizePixel = 0
        toggleBtn.Text = ""
        toggleBtn.AutoButtonColor = false
        toggleBtn.ZIndex = 11
        toggleBtn.Parent = toggleFrame
        
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(1, 0)
        btnCorner.Parent = toggleBtn
        
        local circle = Instance.new("Frame")
        circle.Size = UDim2.new(0, 16, 0, 16)
        circle.Position = currentValue and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
        circle.BackgroundColor3 = currentValue and Color3.fromRGB(15, 15, 20) or COLORS.Gray
        circle.BorderSizePixel = 0
        circle.ZIndex = 11
        circle.Parent = toggleBtn
        
        local circleCorner = Instance.new("UICorner")
        circleCorner.CornerRadius = UDim.new(1, 0)
        circleCorner.Parent = circle
        
        toggleBtn.MouseButton1Click:Connect(function()
            currentValue = not currentValue
            if currentValue then
                TweenService:Create(toggleBtn, FAST_TWEEN, {BackgroundColor3 = COLORS.Accent}):Play()
                TweenService:Create(circle, FAST_TWEEN, {
                    BackgroundColor3 = Color3.fromRGB(15, 15, 20),
                    Position = UDim2.new(1, -18, 0.5, -8)
                }):Play()
            else
                TweenService:Create(toggleBtn, FAST_TWEEN, {BackgroundColor3 = COLORS.SurfaceLight}):Play()
                TweenService:Create(circle, FAST_TWEEN, {
                    BackgroundColor3 = COLORS.Gray,
                    Position = UDim2.new(0, 2, 0.5, -8)
                }):Play()
            end
            callback(currentValue)
        end)
        
        return toggleFrame
    end
    
    CreateSettingLabel("Theme", 1)
    
    local ThemeContainer = Instance.new("Frame")
    ThemeContainer.Size = UDim2.new(1, 0, 0, 70)
    ThemeContainer.BackgroundTransparency = 1
    ThemeContainer.ZIndex = 11
    ThemeContainer.LayoutOrder = 2
    ThemeContainer.Parent = Content
    
    local ThemeGrid = Instance.new("UIGridLayout")
    ThemeGrid.CellSize = UDim2.new(0, 36, 0, 36)
    ThemeGrid.CellPadding = UDim2.new(0, 8, 0, 8)
    ThemeGrid.SortOrder = Enum.SortOrder.LayoutOrder
    ThemeGrid.Parent = ThemeContainer
    
    local themeOrder = {"White", "Red", "Purple", "Yellow", "Green", "Blue"}
    
    for i, themeName in ipairs(themeOrder) do
        local ThemeButton = Instance.new("TextButton")
        ThemeButton.Size = UDim2.new(0, 36, 0, 36)
        ThemeButton.BackgroundColor3 = THEMES[themeName]
        ThemeButton.Text = ""
        ThemeButton.AutoButtonColor = false
        ThemeButton.ZIndex = 11
        ThemeButton.LayoutOrder = i
        ThemeButton.Parent = ThemeContainer
        
        local ThemeCorner = Instance.new("UICorner")
        ThemeCorner.CornerRadius = UDim.new(0, 8)
        ThemeCorner.Parent = ThemeButton
        
        local Selected = Instance.new("ImageLabel")
        Selected.Size = UDim2.new(0, 14, 0, 14)
        Selected.Position = UDim2.new(0.5, -7, 0.5, -7)
        Selected.BackgroundTransparency = 1
        Selected.Image = ICONS.home
        Selected.ImageColor3 = Color3.fromRGB(15, 15, 20)
        Selected.Visible = self.CurrentTheme == themeName
        Selected.ZIndex = 12
        Selected.Parent = ThemeButton
        
        ThemeButton.MouseButton1Click:Connect(function()
            self:ApplyTheme(themeName)
            for _, child in pairs(ThemeContainer:GetChildren()) do
                if child:IsA("TextButton") then
                    local sel = child:FindFirstChildOfClass("ImageLabel")
                    if sel then
                        sel.Visible = false
                    end
                end
            end
            Selected.Visible = true
        end)
    end
    
    CreateSettingLabel("Custom Theme", 3)
    
    local ColorPickerContainer = Instance.new("Frame")
    ColorPickerContainer.Size = UDim2.new(1, 0, 0, 160)
    ColorPickerContainer.BackgroundTransparency = 1
    ColorPickerContainer.ZIndex = 11
    ColorPickerContainer.LayoutOrder = 4
    ColorPickerContainer.Parent = Content
    
    self:CreateColorPicker(ColorPickerContainer, COLORS.Accent, function(color)
        self:ApplyCustomTheme(color)
    end)
    
    CreateToggleSetting("Enable Sounds", self.SoundsEnabled, function(value)
        self.SoundsEnabled = value
        self.ConfigData.SoundsEnabled = value
        self:SaveConfig()
    end, 5)
    
    CreateToggleSetting("Enable Animations", self.AnimationsEnabled, function(value)
        self.AnimationsEnabled = value
        self.ConfigData.AnimationsEnabled = value
        self:SaveConfig()
    end, 6)
    
    CreateToggleSetting("Rounded Corners", self.RoundedCorners, function(value)
        self.RoundedCorners = value
        self.ConfigData.RoundedCorners = value
        self:UpdateCorners()
        self:SaveConfig()
    end, 7)
    
    CreateSettingLabel("Background Image", 8)
    
    local BgImageContainer = Instance.new("Frame")
    BgImageContainer.Size = UDim2.new(1, 0, 0, 62)
    BgImageContainer.BackgroundColor3 = COLORS.Background
    BgImageContainer.BorderSizePixel = 0
    BgImageContainer.ZIndex = 11
    BgImageContainer.LayoutOrder = 9
    BgImageContainer.Parent = Content
    
    local BgImageCorner = Instance.new("UICorner")
    BgImageCorner.CornerRadius = UDim.new(0, 8)
    BgImageCorner.Parent = BgImageContainer
    
    local BgImageInput = Instance.new("TextBox")
    BgImageInput.Size = UDim2.new(1, -24, 0, 30)
    BgImageInput.Position = UDim2.new(0, 12, 0, 16)
    BgImageInput.BackgroundColor3 = COLORS.SurfaceLight
    BgImageInput.BorderSizePixel = 0
    BgImageInput.Text = self.BackgroundImage
    BgImageInput.PlaceholderText = "rbxassetid://123456789"
    BgImageInput.TextColor3 = COLORS.White
    BgImageInput.TextSize = 10
    BgImageInput.Font = Enum.Font.Gotham
    BgImageInput.ClearTextOnFocus = false
    BgImageInput.ZIndex = 11
    BgImageInput.Parent = BgImageContainer
    
    local BgInputCorner = Instance.new("UICorner")
    BgInputCorner.CornerRadius = UDim.new(0, 6)
    BgInputCorner.Parent = BgImageInput
    
    local BgImagePadding = Instance.new("UIPadding")
    BgImagePadding.PaddingLeft = UDim.new(0, 8)
    BgImagePadding.PaddingRight = UDim.new(0, 8)
    BgImagePadding.Parent = BgImageInput
    
    CreateSettingLabel("Background Opacity", 10)
    
    local BgTransSlider = Instance.new("Frame")
    BgTransSlider.Size = UDim2.new(1, 0, 0, 52)
    BgTransSlider.BackgroundColor3 = COLORS.Background
    BgTransSlider.BorderSizePixel = 0
    BgTransSlider.ZIndex = 11
    BgTransSlider.LayoutOrder = 11
    BgTransSlider.Parent = Content
    
    local BgTransCorner = Instance.new("UICorner")
    BgTransCorner.CornerRadius = UDim.new(0, 8)
    BgTransCorner.Parent = BgTransSlider
    
    local BgTransValue = Instance.new("TextLabel")
    BgTransValue.Size = UDim2.new(0, 50, 0, 18)
    BgTransValue.Position = UDim2.new(1, -58, 0, 10)
    BgTransValue.BackgroundTransparency = 1
    BgTransValue.Text = string.format("%.0f%%", (1 - self.BackgroundTransparency) * 100)
    BgTransValue.TextColor3 = COLORS.Accent
    BgTransValue.TextSize = 11
    BgTransValue.Font = Enum.Font.GothamBold
    BgTransValue.TextXAlignment = Enum.TextXAlignment.Right
    BgTransValue.ZIndex = 11
    BgTransValue.Parent = BgTransSlider
    
    local BgTransTrack = Instance.new("Frame")
    BgTransTrack.Size = UDim2.new(1, -24, 0, 4)
    BgTransTrack.Position = UDim2.new(0, 12, 1, -16)
    BgTransTrack.BackgroundColor3 = COLORS.SurfaceLight
    BgTransTrack.BorderSizePixel = 0
    BgTransTrack.ZIndex = 11
    BgTransTrack.Parent = BgTransSlider
    
    local BgTransTrackCorner = Instance.new("UICorner")
    BgTransTrackCorner.CornerRadius = UDim.new(1, 0)
    BgTransTrackCorner.Parent = BgTransTrack
    
    local BgTransFill = Instance.new("Frame")
    BgTransFill.Size = UDim2.new(1 - self.BackgroundTransparency, 0, 1, 0)
    BgTransFill.BackgroundColor3 = COLORS.Accent
    BgTransFill.BorderSizePixel = 0
    BgTransFill.ZIndex = 11
    BgTransFill.Parent = BgTransTrack
    
    local BgTransFillCorner = Instance.new("UICorner")
    BgTransFillCorner.CornerRadius = UDim.new(1, 0)
    BgTransFillCorner.Parent = BgTransFill
    
    local BgTransHandle = Instance.new("Frame")
    BgTransHandle.Size = UDim2.new(0, 12, 0, 12)
    BgTransHandle.Position = UDim2.new(1 - self.BackgroundTransparency, -6, 0.5, -6)
    BgTransHandle.BackgroundColor3 = COLORS.White
    BgTransHandle.BorderSizePixel = 0
    BgTransHandle.ZIndex = 11
    BgTransHandle.Parent = BgTransTrack
    
    local BgTransHandleCorner = Instance.new("UICorner")
    BgTransHandleCorner.CornerRadius = UDim.new(1, 0)
    BgTransHandleCorner.Parent = BgTransHandle
    
    local draggingBgTrans = false
    
    local function updateBgTransparency(value)
        value = math.clamp(value, 0, 1)
        self.BackgroundTransparency = value
        
        BgTransValue.Text = string.format("%.0f%%", (1 - value) * 100)
        BgTransFill.Size = UDim2.new(1 - value, 0, 1, 0)
        BgTransHandle.Position = UDim2.new(1 - value, -6, 0.5, -6)
        
        if self.CustomBg then
            self.CustomBg.ImageTransparency = value
        end
    end
    
    BgTransTrack.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingBgTrans = true
            local relativeX = math.clamp(input.Position.X - BgTransTrack.AbsolutePosition.X, 0, BgTransTrack.AbsoluteSize.X)
            local percent = relativeX / BgTransTrack.AbsoluteSize.X
            updateBgTransparency(1 - percent)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if draggingBgTrans and input.UserInputType == Enum.UserInputType.MouseMovement then
            local relativeX = math.clamp(input.Position.X - BgTransTrack.AbsolutePosition.X, 0, BgTransTrack.AbsoluteSize.X)
            local percent = relativeX / BgTransTrack.AbsoluteSize.X
            updateBgTransparency(1 - percent)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingBgTrans = false
        end
    end)
    
    local SaveButton = Instance.new("TextButton")
    SaveButton.Size = UDim2.new(1, 0, 0, 36)
    SaveButton.BackgroundColor3 = COLORS.Accent
    SaveButton.Text = "Save Configuration"
    SaveButton.TextColor3 = Color3.fromRGB(15, 15, 20)
    SaveButton.TextSize = 11
    SaveButton.Font = Enum.Font.GothamBold
    SaveButton.AutoButtonColor = false
    SaveButton.ZIndex = 11
    SaveButton.LayoutOrder = 12
    SaveButton.Parent = Content
    
    local SaveCorner = Instance.new("UICorner")
    SaveCorner.CornerRadius = UDim.new(0, 8)
    SaveCorner.Parent = SaveButton
    
    SaveButton.MouseButton1Click:Connect(function()
        local bgImageId = BgImageInput.Text
        if bgImageId ~= "" then
            self:ApplyBackgroundImage(bgImageId, self.BackgroundTransparency)
        else
            self:ApplyBackgroundImage("", 1)
        end
        
        self:SaveConfig()
        SaveButton.Text = "Saved!"
        wait(1)
        SaveButton.Text = "Save Configuration"
    end)
end

function ModernUI:CreateHeader()
    local Header = Instance.new("Frame")
    Header.Name = "Header"
    Header.Size = UDim2.new(1, 0, 0, 48)
    Header.BackgroundTransparency = 1
    Header.BorderSizePixel = 0
    Header.Parent = self.MainFrame
    
    local IconFrame = Instance.new("ImageLabel")
    IconFrame.Name = "Icon"
    IconFrame.Size = UDim2.new(0, 28, 0, 28)
    IconFrame.Position = UDim2.new(0, 16, 0.5, -14)
    IconFrame.BackgroundTransparency = 1
    IconFrame.ImageColor3 = COLORS.Accent
    IconFrame.Parent = Header

    self.IconFrame = IconFrame
    AnimateIcon(IconFrame, self.Icon, self.IconFPS)
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "Title"
    TitleLabel.Size = UDim2.new(0, 300, 0, 18)
    TitleLabel.Position = UDim2.new(0, 52, 0, 9)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = self.Title
    TitleLabel.TextColor3 = COLORS.White
    TitleLabel.TextSize = 13
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = Header
    
    local SubtitleLabel = Instance.new("TextLabel")
    SubtitleLabel.Name = "Subtitle"
    SubtitleLabel.Size = UDim2.new(0, 300, 0, 14)
    SubtitleLabel.Position = UDim2.new(0, 52, 0, 27)
    SubtitleLabel.BackgroundTransparency = 1
    SubtitleLabel.Text = self.SubTitle
    SubtitleLabel.TextColor3 = COLORS.Gray
    SubtitleLabel.TextSize = 10
    SubtitleLabel.Font = Enum.Font.Gotham
    SubtitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    SubtitleLabel.Parent = Header
    
    local CloseButton = Instance.new("TextButton")
    CloseButton.Name = "Close"
    CloseButton.Size = UDim2.new(0, 28, 0, 28)
    CloseButton.Position = UDim2.new(1, -40, 0.5, -14)
    CloseButton.BackgroundColor3 = COLORS.Surface
    CloseButton.Text = ""
    CloseButton.AutoButtonColor = false
    CloseButton.Parent = Header
    
    local CloseCorner = Instance.new("UICorner")
    CloseCorner.CornerRadius = UDim.new(0, 7)
    CloseCorner.Parent = CloseButton
    
    local CloseIcon = Instance.new("ImageLabel")
    CloseIcon.Size = UDim2.new(0, 12, 0, 12)
    CloseIcon.Position = UDim2.new(0.5, -6, 0.5, -6)
    CloseIcon.BackgroundTransparency = 1
    CloseIcon.Image = ICONS.home
    CloseIcon.ImageColor3 = COLORS.Icon
    CloseIcon.Parent = CloseButton
    
    CloseButton.MouseButton1Click:Connect(function()
        if self.SoundsEnabled then
            PlaySound("rbxassetid://124782754699900")
        end
        self:ShowConfirmDialog()
    end)
    
    local SettingsButton = Instance.new("TextButton")
    SettingsButton.Name = "Settings"
    SettingsButton.Size = UDim2.new(0, 28, 0, 28)
    SettingsButton.Position = UDim2.new(1, -74, 0.5, -14)
    SettingsButton.BackgroundColor3 = COLORS.Surface
    SettingsButton.Text = ""
    SettingsButton.AutoButtonColor = false
    SettingsButton.Parent = Header
    
    local SettingsCorner = Instance.new("UICorner")
    SettingsCorner.CornerRadius = UDim.new(0, 7)
    SettingsCorner.Parent = SettingsButton
    
    local SettingsIcon = Instance.new("ImageLabel")
    SettingsIcon.Size = UDim2.new(0, 12, 0, 12)
    SettingsIcon.Position = UDim2.new(0.5, -6, 0.5, -6)
    SettingsIcon.BackgroundTransparency = 1
    SettingsIcon.Image = ICONS.settings
    SettingsIcon.ImageColor3 = COLORS.Icon
    SettingsIcon.Parent = SettingsButton
    
    SettingsButton.MouseButton1Click:Connect(function()
        if self.SoundsEnabled then
            PlaySound("rbxassetid://124782754699900")
        end
        self:ShowSettingsWindow()
    end)
    
    local MinimizeButton = Instance.new("TextButton")
    MinimizeButton.Name = "Minimize"
    MinimizeButton.Size = UDim2.new(0, 28, 0, 28)
    MinimizeButton.Position = UDim2.new(1, -108, 0.5, -14)
    MinimizeButton.BackgroundColor3 = COLORS.Surface
    MinimizeButton.Text = ""
    MinimizeButton.AutoButtonColor = false
    MinimizeButton.Parent = Header
    
    local MinCorner = Instance.new("UICorner")
    MinCorner.CornerRadius = UDim.new(0, 7)
    MinCorner.Parent = MinimizeButton
    
    local MinIcon = Instance.new("ImageLabel")
    MinIcon.Size = UDim2.new(0, 12, 0, 12)
    MinIcon.Position = UDim2.new(0.5, -6, 0.5, -6)
    MinIcon.BackgroundTransparency = 1
    MinIcon.Image = ICONS.waves
    MinIcon.ImageColor3 = COLORS.Icon
    MinIcon.Parent = MinimizeButton
    
    MinimizeButton.MouseButton1Click:Connect(function()
        if self.SoundsEnabled then
            PlaySound("rbxassetid://124782754699900")
        end
        self:ToggleUI()
    end)
    
    local Divider = Instance.new("Frame")
    Divider.Name = "Divider"
    Divider.Size = UDim2.new(1, -32, 0, 1)
    Divider.Position = UDim2.new(0, 16, 1, -1)
    Divider.BackgroundColor3 = COLORS.Border
    Divider.BorderSizePixel = 0
    Divider.Parent = Header
end

function ModernUI:CreateSidebar()
    local Sidebar = Instance.new("Frame")
    Sidebar.Name = "Sidebar"
    Sidebar.Size = UDim2.new(0, 136, 1, -62)
    Sidebar.Position = UDim2.new(0, 16, 0, 54)
    Sidebar.BackgroundTransparency = 1
    Sidebar.BorderSizePixel = 0
    Sidebar.Parent = self.MainFrame
    
    local TabList = Instance.new("ScrollingFrame")
    TabList.Name = "TabList"
    TabList.Size = UDim2.new(1, 0, 1, 0)
    TabList.BackgroundTransparency = 1
    TabList.BorderSizePixel = 0
    TabList.ScrollBarThickness = 0
    TabList.CanvasSize = UDim2.new(0, 0, 0, 0)
    TabList.ScrollingDirection = Enum.ScrollingDirection.Y
    TabList.Parent = Sidebar
    
    local ListLayout = Instance.new("UIListLayout")
    ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ListLayout.Padding = UDim.new(0, 4)
    ListLayout.Parent = TabList
    
    ListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        TabList.CanvasSize = UDim2.new(0, 0, 0, ListLayout.AbsoluteContentSize.Y + 8)
    end)
    
    self.TabList = TabList
end

function ModernUI:CreateContentArea()
    local ContentArea = Instance.new("ScrollingFrame")
    ContentArea.Name = "ContentArea"
    ContentArea.Size = UDim2.new(1, -182, 1, -78)
    ContentArea.Position = UDim2.new(0, 166, 0, 54)
    ContentArea.BackgroundTransparency = 1
    ContentArea.BorderSizePixel = 0
    ContentArea.ScrollBarThickness = 3
    ContentArea.ScrollBarImageColor3 = COLORS.Border
    ContentArea.CanvasSize = UDim2.new(0, 0, 0, 0)
    ContentArea.ScrollingDirection = Enum.ScrollingDirection.Y
    ContentArea.Parent = self.MainFrame
    
    local ListLayout = Instance.new("UIListLayout")
    ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ListLayout.Padding = UDim.new(0, 8)
    ListLayout.Parent = ContentArea
    
    local Padding = Instance.new("UIPadding")
    Padding.PaddingLeft = UDim.new(0, 0)
    Padding.PaddingRight = UDim.new(0, 16)
    Padding.PaddingTop = UDim.new(0, 0)
    Padding.PaddingBottom = UDim.new(0, 16)
    Padding.Parent = ContentArea
    
    ListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        ContentArea.CanvasSize = UDim2.new(0, 0, 0, ListLayout.AbsoluteContentSize.Y + 32)
    end)
    
    self.ContentArea = ContentArea
end

function ModernUI:MakeDraggable(frame, handle)
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    local function onInputBegan(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
        end
    end
    
    handle.InputBegan:Connect(onInputBegan)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
end

function ModernUI:MakeResizable()
    local resizing = false
    local resizeStart = nil
    local startSize = nil
    local minWidth = 400
    local minHeight = 300
    local maxWidth = 800
    local maxHeight = 600
    
    local ResizeHandle = Instance.new("Frame")
    ResizeHandle.Name = "ResizeHandle"
    ResizeHandle.Size = UDim2.new(0, 12, 0, 12)
    ResizeHandle.Position = UDim2.new(1, -12, 1, -12)
    ResizeHandle.BackgroundTransparency = 1
    ResizeHandle.Parent = self.MainFrame
    
    ResizeHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            resizing = true
            resizeStart = input.Position
            startSize = self.MainFrame.Size
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if resizing and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - resizeStart
            local newWidth = math.clamp(startSize.X.Offset + delta.X, minWidth, maxWidth)
            local newHeight = math.clamp(startSize.Y.Offset + delta.Y, minHeight, maxHeight)
            self.MainFrame.Size = UDim2.new(0, newWidth, 0, newHeight)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            resizing = false
        end
    end)
end

function ModernUI:SetupMinimizeKey()
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == self.MinimizeKey then
            self:ToggleUI()
        end
    end)
end

function ModernUI:ToggleUI()
    self.MainFrame.Visible = not self.MainFrame.Visible
end

function ModernUI:ShowConfirmDialog()
    local Overlay = Instance.new("Frame")
    Overlay.Name = "ConfirmOverlay"
    Overlay.Size = UDim2.new(1, 0, 1, 0)
    Overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Overlay.BackgroundTransparency = 1
    Overlay.BorderSizePixel = 0
    Overlay.ZIndex = 10
    Overlay.Parent = self.MainFrame
    
    TweenService:Create(Overlay, FAST_TWEEN, {BackgroundTransparency = 0.6}):Play()
    
    local Dialog = Instance.new("Frame")
    Dialog.Name = "Dialog"
    Dialog.Size = UDim2.new(0, 280, 0, 0)
    Dialog.Position = UDim2.new(0.5, -140, 0.5, -70)
    Dialog.BackgroundColor3 = COLORS.Surface
    Dialog.BorderSizePixel = 0
    Dialog.ZIndex = 11
    Dialog.Parent = Overlay
    
    local DialogCorner = Instance.new("UICorner")
    DialogCorner.CornerRadius = UDim.new(0, 12)
    DialogCorner.Parent = Dialog
    
    TweenService:Create(Dialog, TWEEN_INFO, {Size = UDim2.new(0, 280, 0, 140)}):Play()
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, -32, 0, 22)
    Title.Position = UDim2.new(0, 16, 0, 14)
    Title.BackgroundTransparency = 1
    Title.Text = "Confirm Close"
    Title.TextColor3 = COLORS.White
    Title.TextSize = 13
    Title.Font = Enum.Font.GothamBold
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.ZIndex = 11
    Title.Parent = Dialog
    
    local Message = Instance.new("TextLabel")
    Message.Size = UDim2.new(1, -32, 0, 36)
    Message.Position = UDim2.new(0, 16, 0, 40)
    Message.BackgroundTransparency = 1
    Message.Text = "Are you sure you want to close?"
    Message.TextColor3 = COLORS.Gray
    Message.TextSize = 11
    Message.Font = Enum.Font.Gotham
    Message.TextWrapped = true
    Message.TextXAlignment = Enum.TextXAlignment.Left
    Message.TextYAlignment = Enum.TextYAlignment.Top
    Message.ZIndex = 11
    Message.Parent = Dialog
    
    local ButtonContainer = Instance.new("Frame")
    ButtonContainer.Size = UDim2.new(1, -32, 0, 34)
    ButtonContainer.Position = UDim2.new(0, 16, 1, -48)
    ButtonContainer.BackgroundTransparency = 1
    ButtonContainer.ZIndex = 11
    ButtonContainer.Parent = Dialog
    
    local ButtonLayout = Instance.new("UIListLayout")
    ButtonLayout.FillDirection = Enum.FillDirection.Horizontal
    ButtonLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
    ButtonLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ButtonLayout.Padding = UDim.new(0, 8)
    ButtonLayout.Parent = ButtonContainer
    
    local CancelButton = Instance.new("TextButton")
    CancelButton.Name = "Cancel"
    CancelButton.Size = UDim2.new(0, 110, 1, 0)
    CancelButton.BackgroundColor3 = COLORS.SurfaceLight
    CancelButton.Text = "Cancel"
    CancelButton.TextColor3 = COLORS.White
    CancelButton.TextSize = 12
    CancelButton.Font = Enum.Font.GothamMedium
    CancelButton.AutoButtonColor = false
    CancelButton.ZIndex = 11
    CancelButton.LayoutOrder = 1
    CancelButton.Parent = ButtonContainer
    
    local CancelCorner = Instance.new("UICorner")
    CancelCorner.CornerRadius = UDim.new(0, 7)
    CancelCorner.Parent = CancelButton
    
    local ConfirmButton = Instance.new("TextButton")
    ConfirmButton.Name = "Confirm"
    ConfirmButton.Size = UDim2.new(0, 110, 1, 0)
    ConfirmButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    ConfirmButton.Text = "Close"
    ConfirmButton.TextColor3 = COLORS.White
    ConfirmButton.TextSize = 12
    ConfirmButton.Font = Enum.Font.GothamBold
    ConfirmButton.AutoButtonColor = false
    ConfirmButton.ZIndex = 11
    ConfirmButton.LayoutOrder = 2
    ConfirmButton.Parent = ButtonContainer
    
    local ConfirmCorner = Instance.new("UICorner")
    ConfirmCorner.CornerRadius = UDim.new(0, 7)
    ConfirmCorner.Parent = ConfirmButton
    
    ConfirmButton.MouseButton1Click:Connect(function()
        self:SaveConfig()
        TweenService:Create(Dialog, FAST_TWEEN, {Size = UDim2.new(0, 280, 0, 0)}):Play()
        TweenService:Create(Overlay, FAST_TWEEN, {BackgroundTransparency = 1}):Play()
        wait(0.15)
        self.ScreenGui:Destroy()
    end)
    
    CancelButton.MouseButton1Click:Connect(function()
        TweenService:Create(Dialog, FAST_TWEEN, {Size = UDim2.new(0, 280, 0, 0)}):Play()
        TweenService:Create(Overlay, FAST_TWEEN, {BackgroundTransparency = 1}):Play()
        wait(0.15)
        Overlay:Destroy()
    end)
end

function ModernUI:ApplyTheme(themeName)
    if not THEMES[themeName] then return end
    
    self.CurrentTheme = themeName
    COLORS.Accent = THEMES[themeName]
    
    for _, element in pairs(self.AccentElements) do
        if element and element.Parent then
            if element:IsA("ImageLabel") or element:IsA("ImageButton") then
                TweenService:Create(element, FAST_TWEEN, {ImageColor3 = COLORS.Accent}):Play()
            elseif element:IsA("TextLabel") or element:IsA("TextButton") then
                TweenService:Create(element, FAST_TWEEN, {TextColor3 = COLORS.Accent}):Play()
            else
                TweenService:Create(element, FAST_TWEEN, {BackgroundColor3 = COLORS.Accent}):Play()
            end
        end
    end
    
    self.ConfigData.Theme = themeName
    self:SaveConfig()
end

function ModernUI:ApplyCustomTheme(color)
    self.CurrentTheme = "Custom"
    COLORS.Accent = color
    
    for _, element in pairs(self.AccentElements) do
        if element and element.Parent then
            if element:IsA("ImageLabel") or element:IsA("ImageButton") then
                TweenService:Create(element, FAST_TWEEN, {ImageColor3 = COLORS.Accent}):Play()
            elseif element:IsA("TextLabel") or element:IsA("TextButton") then
                TweenService:Create(element, FAST_TWEEN, {TextColor3 = COLORS.Accent}):Play()
            else
                TweenService:Create(element, FAST_TWEEN, {BackgroundColor3 = COLORS.Accent}):Play()
            end
        end
    end
    
    self.ConfigData.Theme = "Custom"
    self.ConfigData.CustomThemeColor = {color.R, color.G, color.B}
    self:SaveConfig()
end

function ModernUI:ApplyAcrylic(enabled)
    local transparency = enabled and 0.3 or 0
    TweenService:Create(self.MainFrame, SLOW_TWEEN, {BackgroundTransparency = transparency}):Play()
    
    self.ConfigData.Acrylic = enabled
    self:SaveConfig()
end

function ModernUI:ApplyBackgroundImage(imageId, transparency)
    self.BackgroundImage = imageId or ""
    self.BackgroundTransparency = transparency or 0.3
    
    if self.CustomBg then
        self.CustomBg.Image = imageId
        TweenService:Create(self.CustomBg, SLOW_TWEEN, {ImageTransparency = transparency}):Play()
    end
    
    self.ConfigData.BackgroundImage = imageId
    self.ConfigData.BackgroundTransparency = transparency
    self:SaveConfig()
end

function ModernUI:UpdateCorners()
    local cornerRadius = self.RoundedCorners and 12 or 0
    
    for _, child in pairs(self.MainFrame:GetDescendants()) do
        if child:IsA("UICorner") then
            TweenService:Create(child, FAST_TWEEN, {CornerRadius = UDim.new(0, cornerRadius)}):Play()
        end
    end
end

function ModernUI:CreateTab(config)
    local Tab = {}
    
    config = config or {}
    local name = config.Name or "Tab"
    local icon = config.Icon or ICONS.home
    
    if type(icon) == "string" and ICONS[icon] then
        icon = ICONS[icon]
    end
    
    local TabButton = Instance.new("TextButton")
    TabButton.Name = name
    TabButton.Size = UDim2.new(1, 0, 0, 36)
    TabButton.BackgroundColor3 = COLORS.Background
    TabButton.BorderSizePixel = 0
    TabButton.Text = ""
    TabButton.AutoButtonColor = false
    TabButton.Parent = self.TabList
    
    local TabCorner = Instance.new("UICorner")
    TabCorner.CornerRadius = UDim.new(0, 8)
    TabCorner.Parent = TabButton
     
    local Indicator = Instance.new("Frame")
    Indicator.Name = "Indicator"
    Indicator.Size = UDim2.new(0, 2, 0, 16)
    Indicator.Position = UDim2.new(0, 0, 0.5, -8)
    Indicator.BackgroundColor3 = COLORS.Accent
    Indicator.BorderSizePixel = 0
    Indicator.Visible = false
    Indicator.Parent = TabButton
    
    table.insert(self.AccentElements, Indicator)
    
    local IndicatorCorner = Instance.new("UICorner")
    IndicatorCorner.CornerRadius = UDim.new(1, 0)
    IndicatorCorner.Parent = Indicator
    
    local IconLabel = Instance.new("ImageLabel")
    IconLabel.Size = UDim2.new(0, 16, 0, 16)
    IconLabel.Position = UDim2.new(0, 10, 0.5, -8)
    IconLabel.BackgroundTransparency = 1
    IconLabel.ImageColor3 = COLORS.Icon
    IconLabel.Parent = TabButton
    
    AnimateIcon(IconLabel, icon, 0.1)
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, -36, 1, 0)
    Label.Position = UDim2.new(0, 32, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = COLORS.Gray
    Label.TextSize = 11
    Label.Font = Enum.Font.GothamMedium
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = TabButton
    
    local Container = Instance.new("Frame")
    Container.Name = name .. "Container"
    Container.Size = UDim2.new(1, 0, 0, 0)
    Container.BackgroundTransparency = 1
    Container.Visible = false
    Container.Parent = self.ContentArea
    
    local ListLayout = Instance.new("UIListLayout")
    ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ListLayout.Padding = UDim.new(0, 8)
    ListLayout.Parent = Container
    
    ListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Container.Size = UDim2.new(1, 0, 0, ListLayout.AbsoluteContentSize.Y)
    end)
    
    TabButton.MouseButton1Click:Connect(function()
        self:SelectTab(Tab)
    end)
    
    TabButton.MouseEnter:Connect(function()
        if self.CurrentTab ~= Tab then
            TweenService:Create(TabButton, FAST_TWEEN, {BackgroundColor3 = COLORS.Surface}):Play()
        end
    end)
    
    TabButton.MouseLeave:Connect(function()
        if self.CurrentTab ~= Tab then
            TweenService:Create(TabButton, FAST_TWEEN, {BackgroundColor3 = COLORS.Background}):Play()
        end
    end)
    
    Tab.Button = TabButton
    Tab.Container = Container
    Tab.Indicator = Indicator
    Tab.IconLabel = IconLabel
    Tab.Label = Label
    Tab.Name = name
    
    table.insert(self.Tabs, Tab)
    
    if not self.CurrentTab then
        self:SelectTab(Tab)
    end
    
    return Tab
end

function ModernUI:SelectTab(tab)
    for _, t in ipairs(self.Tabs) do
        t.Container.Visible = false
        t.Indicator.Visible = false
        TweenService:Create(t.Button, FAST_TWEEN, {BackgroundColor3 = COLORS.Background}):Play()
        TweenService:Create(t.IconLabel, FAST_TWEEN, {ImageColor3 = COLORS.Icon}):Play()
        TweenService:Create(t.Label, FAST_TWEEN, {TextColor3 = COLORS.Gray}):Play()
    end
    
    tab.Container.Visible = true
    tab.Indicator.Visible = true
    TweenService:Create(tab.Button, FAST_TWEEN, {BackgroundColor3 = COLORS.SurfaceLight}):Play()
    TweenService:Create(tab.IconLabel, FAST_TWEEN, {ImageColor3 = COLORS.Accent}):Play()
    TweenService:Create(tab.Label, FAST_TWEEN, {TextColor3 = COLORS.White}):Play()
    
    self.CurrentTab = tab
end

function ModernUI:AddSection(tab, config)
    config = config or {}
    local name = config.Name or "Section"
    
    local Section = Instance.new("Frame")
    Section.Name = "Section"
    Section.Size = UDim2.new(1, 0, 0, 32)
    Section.BackgroundTransparency = 1
    Section.Parent = tab.Container
    
    local TempLabel = Instance.new("TextLabel")
    TempLabel.Text = "  " .. name .. "  "
    TempLabel.TextSize = 11
    TempLabel.Font = Enum.Font.GothamBold
    TempLabel.Parent = Section
    local textWidth = TempLabel.TextBounds.X
    TempLabel:Destroy()
    
    local totalWidth = Section.AbsoluteSize.X
    if totalWidth == 0 then
        totalWidth = 380
    end
    
    local leftLineWidth = (totalWidth - textWidth) / 2
    local rightLineWidth = (totalWidth - textWidth) / 2
    
    local LeftLine = Instance.new("Frame")
    LeftLine.Name = "LeftLine"
    LeftLine.Size = UDim2.new(0, leftLineWidth, 0, 1)
    LeftLine.Position = UDim2.new(0, 0, 0.5, -0.5)
    LeftLine.BackgroundColor3 = COLORS.Accent
    LeftLine.BorderSizePixel = 0
    LeftLine.Parent = Section
    
    table.insert(self.AccentElements, LeftLine)
    
    local LeftGradient = Instance.new("UIGradient")
    LeftGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, COLORS.Background),
        ColorSequenceKeypoint.new(0.5, COLORS.Accent),
        ColorSequenceKeypoint.new(1, COLORS.Accent)
    })
    LeftGradient.Rotation = 0
    LeftGradient.Parent = LeftLine
    
    local RightLine = Instance.new("Frame")
    RightLine.Name = "RightLine"
    RightLine.Size = UDim2.new(0, rightLineWidth, 0, 1)
    RightLine.Position = UDim2.new(1, -rightLineWidth, 0.5, -0.5)
    RightLine.BackgroundColor3 = COLORS.Accent
    RightLine.BorderSizePixel = 0
    RightLine.Parent = Section
    
    table.insert(self.AccentElements, RightLine)
    
    local RightGradient = Instance.new("UIGradient")
    RightGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, COLORS.Accent),
        ColorSequenceKeypoint.new(0.5, COLORS.Accent),
        ColorSequenceKeypoint.new(1, COLORS.Background)
    })
    RightGradient.Rotation = 0
    RightGradient.Parent = RightLine
    
    local SectionLabel = Instance.new("TextLabel")
    SectionLabel.Size = UDim2.new(0, textWidth, 1, 0)
    SectionLabel.Position = UDim2.new(0.5, -textWidth / 2, 0, 0)
    SectionLabel.BackgroundTransparency = 1
    SectionLabel.Text = name
    SectionLabel.TextColor3 = COLORS.Accent
    SectionLabel.TextSize = 11
    SectionLabel.Font = Enum.Font.GothamBold
    SectionLabel.Parent = Section
    
    table.insert(self.AccentElements, SectionLabel)
    
    return Section
end

function ModernUI:AddParagraph(tab, config)
    config = config or {}
    local title = config.Title or "Paragraph Title"
    local content = config.Content or "Paragraph content goes here"
    
    local Paragraph = Instance.new("Frame")
    Paragraph.Name = "Paragraph"
    Paragraph.Size = UDim2.new(1, 0, 0, 70)
    Paragraph.BackgroundColor3 = COLORS.Surface
    Paragraph.BorderSizePixel = 0
    Paragraph.Parent = tab.Container
    
    local ParaCorner = Instance.new("UICorner")
    ParaCorner.CornerRadius = UDim.new(0, 8)
    ParaCorner.Parent = Paragraph
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -24, 0, 18)
    TitleLabel.Position = UDim2.new(0, 12, 0, 10)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title
    TitleLabel.TextColor3 = COLORS.White
    TitleLabel.TextSize = 12
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = Paragraph
    
    local ContentLabel = Instance.new("TextLabel")
    ContentLabel.Size = UDim2.new(1, -24, 1, -36)
    ContentLabel.Position = UDim2.new(0, 12, 0, 30)
    ContentLabel.BackgroundTransparency = 1
    ContentLabel.Text = content
    ContentLabel.TextColor3 = COLORS.Gray
    ContentLabel.TextSize = 10
    ContentLabel.Font = Enum.Font.Gotham
    ContentLabel.TextWrapped = true
    ContentLabel.TextXAlignment = Enum.TextXAlignment.Left
    ContentLabel.TextYAlignment = Enum.TextYAlignment.Top
    ContentLabel.Parent = Paragraph
    
    local function updateSize()
        if ContentLabel.AbsoluteSize.X > 0 then
            local textHeight = TextService:GetTextSize(
                content,
                10,
                Enum.Font.Gotham,
                Vector2.new(ContentLabel.AbsoluteSize.X, math.huge)
            ).Y
            Paragraph.Size = UDim2.new(1, 0, 0, math.max(70, textHeight + 46))
        end
    end
    
    updateSize()
    
    ContentLabel:GetPropertyChangedSignal("AbsoluteSize"):Connect(updateSize)
    
    Paragraph.SetContent = function(newContent)
        content = newContent
        ContentLabel.Text = newContent
        updateSize()
    end
    
    Paragraph.SetTitle = function(newTitle)
        title = newTitle
        TitleLabel.Text = newTitle
    end
    
    return Paragraph
end

function ModernUI:AddToggle(tab, config)
    config = config or {}
    local name = config.Name or "Toggle"
    local description = config.Description or ""
    local default = config.Default or false
    local callback = config.Callback or function() end
    
    local Toggle = Instance.new("Frame")
    Toggle.Name = "Toggle"
    Toggle.Size = UDim2.new(1, 0, 0, description == "" and 38 or 50)
    Toggle.BackgroundColor3 = COLORS.Surface
    Toggle.BorderSizePixel = 0
    Toggle.Parent = tab.Container
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 8)
    ToggleCorner.Parent = Toggle
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.7, 0, description == "" and 1 or 0.5, 0)
    Label.Position = UDim2.new(0, 12, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = COLORS.White
    Label.TextSize = 12
    Label.Font = Enum.Font.GothamMedium
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = Toggle
    
    if description ~= "" then
        local DescLabel = Instance.new("TextLabel")
        DescLabel.Size = UDim2.new(0.7, 0, 0.5, 0)
        DescLabel.Position = UDim2.new(0, 12, 0.5, 0)
        DescLabel.BackgroundTransparency = 1
        DescLabel.Text = description
        DescLabel.TextColor3 = COLORS.Gray
        DescLabel.TextSize = 9
        DescLabel.Font = Enum.Font.Gotham
        DescLabel.TextXAlignment = Enum.TextXAlignment.Left
        DescLabel.TextYAlignment = Enum.TextYAlignment.Top
        DescLabel.Parent = Toggle
    end
    
    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Size = UDim2.new(0, 40, 0, 20)
    ToggleButton.Position = UDim2.new(1, -52, description == "" and 0.5 or 0.25, -10)
    ToggleButton.BackgroundColor3 = COLORS.SurfaceLight
    ToggleButton.BorderSizePixel = 0
    ToggleButton.Text = ""
    ToggleButton.AutoButtonColor = false
    ToggleButton.Parent = Toggle
    
    local ToggleCorner2 = Instance.new("UICorner")
    ToggleCorner2.CornerRadius = UDim.new(1, 0)
    ToggleCorner2.Parent = ToggleButton
    
    local ToggleCircle = Instance.new("Frame")
    ToggleCircle.Size = UDim2.new(0, 16, 0, 16)
    ToggleCircle.Position = UDim2.new(0, 2, 0.5, -8)
    ToggleCircle.BackgroundColor3 = COLORS.Gray
    ToggleCircle.BorderSizePixel = 0
    ToggleCircle.Parent = ToggleButton
    
    local CircleCorner = Instance.new("UICorner")
    CircleCorner.CornerRadius = UDim.new(1, 0)
    CircleCorner.Parent = ToggleCircle
    
    local toggled = default or false
    
    if toggled then
        ToggleButton.BackgroundColor3 = COLORS.Accent
        ToggleCircle.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
        ToggleCircle.Position = UDim2.new(1, -18, 0.5, -8)
    end
    
    if self.ConfigData.Toggles[name] ~= nil then
        toggled = self.ConfigData.Toggles[name]
        if toggled then
            ToggleButton.BackgroundColor3 = COLORS.Accent
            ToggleCircle.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
            ToggleCircle.Position = UDim2.new(1, -18, 0.5, -8)
        end
        
        task.spawn(function()
            if callback then
                callback(toggled)
            end
        end)
    end
    
    table.insert(self.AccentElements, ToggleButton)
    
    local function updateToggle()
        if toggled then
            TweenService:Create(ToggleButton, FAST_TWEEN, {BackgroundColor3 = COLORS.Accent}):Play()
            TweenService:Create(ToggleCircle, FAST_TWEEN, {
                BackgroundColor3 = Color3.fromRGB(15, 15, 20),
                Position = UDim2.new(1, -18, 0.5, -8)
            }):Play()
            if self.SoundsEnabled then
                PlaySound("rbxassetid://78630464567609")
            end
        else
            TweenService:Create(ToggleButton, FAST_TWEEN, {BackgroundColor3 = COLORS.SurfaceLight}):Play()
            TweenService:Create(ToggleCircle, FAST_TWEEN, {
                BackgroundColor3 = COLORS.Gray,
                Position = UDim2.new(0, 2, 0.5, -8)
            }):Play()
            if self.SoundsEnabled then
                PlaySound("rbxassetid://78630464567609")
            end
        end
    end
    
    ToggleButton.MouseButton1Click:Connect(function()
        toggled = not toggled
        updateToggle()
        
        self.ConfigData.Toggles[name] = toggled
        self:SaveConfig()
        
        if callback then
            callback(toggled)
        end
    end)
    
    Toggle.MouseEnter:Connect(function()
        TweenService:Create(Toggle, FAST_TWEEN, {BackgroundColor3 = COLORS.SurfaceLight}):Play()
    end)
    
    Toggle.MouseLeave:Connect(function()
        TweenService:Create(Toggle, FAST_TWEEN, {BackgroundColor3 = COLORS.Surface}):Play()
    end)
    
    return Toggle
end

function ModernUI:AddDropdown(tab, config)
    config = config or {}
    local name = config.Name or "Dropdown"
    local description = config.Description or ""
    local options = config.Options or {"Option 1", "Option 2"}
    local default = config.Default or options[1]
    local callback = config.Callback or function() end
    
    local Dropdown = Instance.new("Frame")
    Dropdown.Name = "Dropdown"
    Dropdown.Size = UDim2.new(1, 0, 0, description == "" and 62 or 72)
    Dropdown.BackgroundTransparency = 1
    Dropdown.Parent = tab.Container
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, 0, 0, 16)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = COLORS.Gray
    Label.TextSize = 10
    Label.Font = Enum.Font.GothamMedium
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = Dropdown
    
    if description ~= "" then
        local DescLabel = Instance.new("TextLabel")
        DescLabel.Size = UDim2.new(1, 0, 0, 12)
        DescLabel.Position = UDim2.new(0, 0, 0, 16)
        DescLabel.BackgroundTransparency = 1
        DescLabel.Text = description
        DescLabel.TextColor3 = COLORS.DarkGray
        DescLabel.TextSize = 9
        DescLabel.Font = Enum.Font.Gotham
        DescLabel.TextXAlignment = Enum.TextXAlignment.Left
        DescLabel.Parent = Dropdown
    end
    
    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(1, 0, 0, 38)
    Container.Position = UDim2.new(0, 0, 0, description == "" and 24 or 34)
    Container.BackgroundColor3 = COLORS.Surface
    Container.BorderSizePixel = 0
    Container.Parent = Dropdown
    
    local ContainerCorner = Instance.new("UICorner")
    ContainerCorner.CornerRadius = UDim.new(0, 8)
    ContainerCorner.Parent = Container
    
    local DropdownButton = Instance.new("TextButton")
    DropdownButton.Size = UDim2.new(1, 0, 1, 0)
    DropdownButton.BackgroundTransparency = 1
    DropdownButton.Text = ""
    DropdownButton.AutoButtonColor = false
    DropdownButton.Parent = Container
    
    local SelectedLabel = Instance.new("TextLabel")
    SelectedLabel.Size = UDim2.new(1, -40, 1, 0)
    SelectedLabel.Position = UDim2.new(0, 12, 0, 0)
    SelectedLabel.BackgroundTransparency = 1
    SelectedLabel.Text = default or options[1] or ""
    SelectedLabel.TextColor3 = COLORS.White
    SelectedLabel.TextSize = 12
    SelectedLabel.Font = Enum.Font.GothamMedium
    SelectedLabel.TextXAlignment = Enum.TextXAlignment.Left
    SelectedLabel.Parent = DropdownButton
    
    local Arrow = Instance.new("ImageLabel")
    Arrow.Size = UDim2.new(0, 12, 0, 12)
    Arrow.Position = UDim2.new(1, -24, 0.5, -6)
    Arrow.BackgroundTransparency = 1
    Arrow.Image = ICONS.waves
    Arrow.ImageColor3 = COLORS.Icon
    Arrow.Rotation = 0
    Arrow.Parent = DropdownButton
    
    local DropdownList = Instance.new("Frame")
    DropdownList.Size = UDim2.new(1, 0, 0, 0)
    DropdownList.Position = UDim2.new(0, 0, 0, description == "" and 68 or 78)
    DropdownList.BackgroundColor3 = COLORS.Surface
    DropdownList.BorderSizePixel = 0
    DropdownList.Visible = false
    DropdownList.ZIndex = 5
    DropdownList.ClipsDescendants = true
    DropdownList.Parent = Dropdown
    
    local ListCorner = Instance.new("UICorner")
    ListCorner.CornerRadius = UDim.new(0, 8)
    ListCorner.Parent = DropdownList
    
    local ListContainer = Instance.new("ScrollingFrame")
    ListContainer.Size = UDim2.new(1, 0, 1, 0)
    ListContainer.BackgroundTransparency = 1
    ListContainer.BorderSizePixel = 0
    ListContainer.ScrollBarThickness = 0
    ListContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
    ListContainer.ZIndex = 6
    ListContainer.Parent = DropdownList
    
    local ListLayout = Instance.new("UIListLayout")
    ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ListLayout.Padding = UDim.new(0, 2)
    ListLayout.Parent = ListContainer
    
    local ListPadding = Instance.new("UIPadding")
    ListPadding.PaddingLeft = UDim.new(0, 6)
    ListPadding.PaddingRight = UDim.new(0, 6)
    ListPadding.PaddingTop = UDim.new(0, 6)
    ListPadding.PaddingBottom = UDim.new(0, 6)
    ListPadding.Parent = ListContainer
    
    local isOpen = false
    local selectedOption = default or options[1]
    
    if self.ConfigData.Dropdowns[name] ~= nil then
        selectedOption = self.ConfigData.Dropdowns[name]
        SelectedLabel.Text = selectedOption
        
        task.spawn(function()
            if callback then
                callback(selectedOption)
            end
        end)
    end
    
    for i, option in ipairs(options) do
        local OptionButton = Instance.new("TextButton")
        OptionButton.Size = UDim2.new(1, 0, 0, 30)
        OptionButton.BackgroundColor3 = COLORS.Background
        OptionButton.BorderSizePixel = 0
        OptionButton.Text = ""
        OptionButton.AutoButtonColor = false
        OptionButton.ZIndex = 6
        OptionButton.Parent = ListContainer
        
        local OptionCorner = Instance.new("UICorner")
        OptionCorner.CornerRadius = UDim.new(0, 6)
        OptionCorner.Parent = OptionButton
        
        local OptionLabel = Instance.new("TextLabel")
        OptionLabel.Size = UDim2.new(1, -28, 1, 0)
        OptionLabel.Position = UDim2.new(0, 10, 0, 0)
        OptionLabel.BackgroundTransparency = 1
        OptionLabel.Text = option
        OptionLabel.TextColor3 = COLORS.White
        OptionLabel.TextSize = 11
        OptionLabel.Font = Enum.Font.GothamMedium
        OptionLabel.TextXAlignment = Enum.TextXAlignment.Left
        OptionLabel.ZIndex = 6
        OptionLabel.Parent = OptionButton
        
        local Indicator = Instance.new("Frame")
        Indicator.Size = UDim2.new(0, 3, 0, 14)
        Indicator.Position = UDim2.new(1, -10, 0.5, -7)
        Indicator.BackgroundColor3 = COLORS.Accent
        Indicator.BorderSizePixel = 0
        Indicator.Visible = option == selectedOption
        Indicator.ZIndex = 6
        Indicator.Parent = OptionButton
        
        table.insert(self.AccentElements, Indicator)
        
        OptionButton.MouseButton1Click:Connect(function()
            selectedOption = option
            SelectedLabel.Text = option
            
            for _, child in ipairs(ListContainer:GetChildren()) do
                if child:IsA("TextButton") then
                    local ind = child:FindFirstChild("Frame")
                    if ind then
                        ind.Visible = false
                    end
                end
            end
            
            Indicator.Visible = true
            Indicator.Size = UDim2.new(0, 0, 0, 14)
            TweenService:Create(Indicator, FAST_TWEEN, {Size = UDim2.new(0, 3, 0, 14)}):Play()
            
            self.ConfigData.Dropdowns[name] = selectedOption
            self:SaveConfig()
            
            if callback then
                callback(option)
            end
        end)
        
        OptionButton.MouseEnter:Connect(function()
            TweenService:Create(OptionButton, FAST_TWEEN, {BackgroundColor3 = COLORS.SurfaceLight}):Play()
        end)
        
        OptionButton.MouseLeave:Connect(function()
            TweenService:Create(OptionButton, FAST_TWEEN, {BackgroundColor3 = COLORS.Background}):Play()
        end)
    end
    
    ListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        ListContainer.CanvasSize = UDim2.new(0, 0, 0, ListLayout.AbsoluteContentSize.Y + 12)
    end)
    
    DropdownButton.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        DropdownList.Visible = true
        
        if isOpen then
            TweenService:Create(Arrow, FAST_TWEEN, {Rotation = 180, ImageColor3 = COLORS.Accent}):Play()
            local targetHeight = math.min(160, ListLayout.AbsoluteContentSize.Y + 12)
            TweenService:Create(DropdownList, TWEEN_INFO, {Size = UDim2.new(1, 0, 0, targetHeight)}):Play()
            TweenService:Create(Dropdown, TWEEN_INFO, {Size = UDim2.new(1, 0, 0, (description == "" and 74 or 84) + targetHeight)}):Play()
        else
            TweenService:Create(Arrow, FAST_TWEEN, {Rotation = 0, ImageColor3 = COLORS.Icon}):Play()
            TweenService:Create(DropdownList, TWEEN_INFO, {Size = UDim2.new(1, 0, 0, 0)}):Play()
            TweenService:Create(Dropdown, TWEEN_INFO, {Size = UDim2.new(1, 0, 0, description == "" and 62 or 72)}):Play()
            wait(0.3)
            if not isOpen then
                DropdownList.Visible = false
            end
        end
    end)
    
    Container.MouseEnter:Connect(function()
        TweenService:Create(Container, FAST_TWEEN, {BackgroundColor3 = COLORS.SurfaceLight}):Play()
    end)
    
    Container.MouseLeave:Connect(function()
        TweenService:Create(Container, FAST_TWEEN, {BackgroundColor3 = COLORS.Surface}):Play()
    end)
    
    return Dropdown
end

function ModernUI:AddMultiDropdown(tab, config)
    config = config or {}
    local name = config.Name or "Multi Dropdown"
    local description = config.Description or ""
    local options = config.Options or {"Option 1", "Option 2"}
    local defaults = config.Default or {}
    local callback = config.Callback or function() end
    
    local Dropdown = Instance.new("Frame")
    Dropdown.Name = "MultiDropdown"
    Dropdown.Size = UDim2.new(1, 0, 0, description == "" and 62 or 72)
    Dropdown.BackgroundTransparency = 1
    Dropdown.Parent = tab.Container
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, 0, 0, 16)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = COLORS.Gray
    Label.TextSize = 10
    Label.Font = Enum.Font.GothamMedium
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = Dropdown
    
    if description ~= "" then
        local DescLabel = Instance.new("TextLabel")
        DescLabel.Size = UDim2.new(1, 0, 0, 12)
        DescLabel.Position = UDim2.new(0, 0, 0, 16)
        DescLabel.BackgroundTransparency = 1
        DescLabel.Text = description
        DescLabel.TextColor3 = COLORS.DarkGray
        DescLabel.TextSize = 9
        DescLabel.Font = Enum.Font.Gotham
        DescLabel.TextXAlignment = Enum.TextXAlignment.Left
        DescLabel.Parent = Dropdown
    end
    
    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(1, 0, 0, 38)
    Container.Position = UDim2.new(0, 0, 0, description == "" and 24 or 34)
    Container.BackgroundColor3 = COLORS.Surface
    Container.BorderSizePixel = 0
    Container.Parent = Dropdown
    
    local ContainerCorner = Instance.new("UICorner")
    ContainerCorner.CornerRadius = UDim.new(0, 8)
    ContainerCorner.Parent = Container
    
    local DropdownButton = Instance.new("TextButton")
    DropdownButton.Size = UDim2.new(1, 0, 1, 0)
    DropdownButton.BackgroundTransparency = 1
    DropdownButton.Text = ""
    DropdownButton.AutoButtonColor = false
    DropdownButton.Parent = Container
    
    local selectedOptions = defaults or {}
    
    if self.ConfigData.MultiDropdowns[name] ~= nil then
        selectedOptions = self.ConfigData.MultiDropdowns[name]
        
        task.spawn(function()
            if callback then
                callback(selectedOptions)
            end
        end)
    end
    
    local SelectedLabel = Instance.new("TextLabel")
    SelectedLabel.Size = UDim2.new(1, -40, 1, 0)
    SelectedLabel.Position = UDim2.new(0, 12, 0, 0)
    SelectedLabel.BackgroundTransparency = 1
    SelectedLabel.Text = "None selected"
    SelectedLabel.TextColor3 = COLORS.Gray
    SelectedLabel.TextSize = 12
    SelectedLabel.Font = Enum.Font.GothamMedium
    SelectedLabel.TextXAlignment = Enum.TextXAlignment.Left
    SelectedLabel.Parent = DropdownButton
    
    local function updateLabel()
        if #selectedOptions == 0 then
            SelectedLabel.Text = "None selected"
            SelectedLabel.TextColor3 = COLORS.Gray
        elseif #selectedOptions == 1 then
            SelectedLabel.Text = selectedOptions[1]
            SelectedLabel.TextColor3 = COLORS.White
        else
            SelectedLabel.Text = #selectedOptions .. " selected"
            SelectedLabel.TextColor3 = COLORS.Accent
        end
    end
    
    updateLabel()
    
    table.insert(self.AccentElements, SelectedLabel)
    
    local Arrow = Instance.new("ImageLabel")
    Arrow.Size = UDim2.new(0, 12, 0, 12)
    Arrow.Position = UDim2.new(1, -24, 0.5, -6)
    Arrow.BackgroundTransparency = 1
    Arrow.Image = ICONS.waves
    Arrow.ImageColor3 = COLORS.Icon
    Arrow.Rotation = 0
    Arrow.Parent = DropdownButton
    
    local DropdownList = Instance.new("Frame")
    DropdownList.Size = UDim2.new(1, 0, 0, 0)
    DropdownList.Position = UDim2.new(0, 0, 0, description == "" and 68 or 78)
    DropdownList.BackgroundColor3 = COLORS.Surface
    DropdownList.BorderSizePixel = 0
    DropdownList.Visible = false
    DropdownList.ZIndex = 5
    DropdownList.ClipsDescendants = true
    DropdownList.Parent = Dropdown
    
    local ListCorner = Instance.new("UICorner")
    ListCorner.CornerRadius = UDim.new(0, 8)
    ListCorner.Parent = DropdownList
    
    local ListContainer = Instance.new("ScrollingFrame")
    ListContainer.Size = UDim2.new(1, 0, 1, 0)
    ListContainer.BackgroundTransparency = 1
    ListContainer.BorderSizePixel = 0
    ListContainer.ScrollBarThickness = 0
    ListContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
    ListContainer.ZIndex = 6
    ListContainer.Parent = DropdownList
    
    local ListLayout = Instance.new("UIListLayout")
    ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ListLayout.Padding = UDim.new(0, 2)
    ListLayout.Parent = ListContainer
    
    local ListPadding = Instance.new("UIPadding")
    ListPadding.PaddingLeft = UDim.new(0, 6)
    ListPadding.PaddingRight = UDim.new(0, 6)
    ListPadding.PaddingTop = UDim.new(0, 6)
    ListPadding.PaddingBottom = UDim.new(0, 6)
    ListPadding.Parent = ListContainer
    
    local isOpen = false
    
    for i, option in ipairs(options) do
        local OptionButton = Instance.new("TextButton")
        OptionButton.Size = UDim2.new(1, 0, 0, 30)
        OptionButton.BackgroundColor3 = COLORS.Background
        OptionButton.BorderSizePixel = 0
        OptionButton.Text = ""
        OptionButton.AutoButtonColor = false
        OptionButton.ZIndex = 6
        OptionButton.Parent = ListContainer
        
        local OptionCorner = Instance.new("UICorner")
        OptionCorner.CornerRadius = UDim.new(0, 6)
        OptionCorner.Parent = OptionButton
        
        local OptionLabel = Instance.new("TextLabel")
        OptionLabel.Size = UDim2.new(1, -28, 1, 0)
        OptionLabel.Position = UDim2.new(0, 10, 0, 0)
        OptionLabel.BackgroundTransparency = 1
        OptionLabel.Text = option
        OptionLabel.TextColor3 = COLORS.White
        OptionLabel.TextSize = 11
        OptionLabel.Font = Enum.Font.GothamMedium
        OptionLabel.TextXAlignment = Enum.TextXAlignment.Left
        OptionLabel.ZIndex = 6
        OptionLabel.Parent = OptionButton
        
        local Indicator = Instance.new("Frame")
        Indicator.Size = UDim2.new(0, 3, 0, 14)
        Indicator.Position = UDim2.new(1, -10, 0.5, -7)
        Indicator.BackgroundColor3 = COLORS.Accent
        Indicator.BorderSizePixel = 0
        Indicator.Visible = table.find(selectedOptions, option) ~= nil
        Indicator.ZIndex = 6
        Indicator.Parent = OptionButton
        
        table.insert(self.AccentElements, Indicator)
        
        OptionButton.MouseButton1Click:Connect(function()
            local index = table.find(selectedOptions, option)
            
            if index then
                table.remove(selectedOptions, index)
                Indicator.Visible = false
            else
                table.insert(selectedOptions, option)
                Indicator.Visible = true
                Indicator.Size = UDim2.new(0, 0, 0, 14)
                TweenService:Create(Indicator, FAST_TWEEN, {Size = UDim2.new(0, 3, 0, 14)}):Play()
            end
            
            updateLabel()
            
            self.ConfigData.MultiDropdowns[name] = selectedOptions
            self:SaveConfig()
            
            if callback then
                callback(selectedOptions)
            end
        end)
        
        OptionButton.MouseEnter:Connect(function()
            TweenService:Create(OptionButton, FAST_TWEEN, {BackgroundColor3 = COLORS.SurfaceLight}):Play()
        end)
        
        OptionButton.MouseLeave:Connect(function()
            TweenService:Create(OptionButton, FAST_TWEEN, {BackgroundColor3 = COLORS.Background}):Play()
        end)
    end
    
    ListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        ListContainer.CanvasSize = UDim2.new(0, 0, 0, ListLayout.AbsoluteContentSize.Y + 12)
    end)
    
    DropdownButton.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        DropdownList.Visible = true
        
        if isOpen then
            TweenService:Create(Arrow, FAST_TWEEN, {Rotation = 180, ImageColor3 = COLORS.Accent}):Play()
            local targetHeight = math.min(160, ListLayout.AbsoluteContentSize.Y + 12)
            TweenService:Create(DropdownList, TWEEN_INFO, {Size = UDim2.new(1, 0, 0, targetHeight)}):Play()
            TweenService:Create(Dropdown, TWEEN_INFO, {Size = UDim2.new(1, 0, 0, (description == "" and 74 or 84) + targetHeight)}):Play()
        else
            TweenService:Create(Arrow, FAST_TWEEN, {Rotation = 0, ImageColor3 = COLORS.Icon}):Play()
            TweenService:Create(DropdownList, TWEEN_INFO, {Size = UDim2.new(1, 0, 0, 0)}):Play()
            TweenService:Create(Dropdown, TWEEN_INFO, {Size = UDim2.new(1, 0, 0, description == "" and 62 or 72)}):Play()
            wait(0.3)
            if not isOpen then
                DropdownList.Visible = false
            end
        end
    end)
    
    Container.MouseEnter:Connect(function()
        TweenService:Create(Container, FAST_TWEEN, {BackgroundColor3 = COLORS.SurfaceLight}):Play()
    end)
    
    Container.MouseLeave:Connect(function()
        TweenService:Create(Container, FAST_TWEEN, {BackgroundColor3 = COLORS.Surface}):Play()
    end)
    
    return Dropdown
end

function ModernUI:AddButton(tab, config)
    config = config or {}
    local name = config.Name or "Button"
    local description = config.Description or ""
    local callback = config.Callback or function() end
    
    local Button = Instance.new("Frame")
    Button.Name = "Button"
    Button.Size = UDim2.new(1, 0, 0, description == "" and 38 or 50)
    Button.BackgroundTransparency = 1
    Button.Parent = tab.Container
    
    local ButtonFrame = Instance.new("TextButton")
    ButtonFrame.Size = UDim2.new(1, 0, 1, 0)
    ButtonFrame.BackgroundColor3 = COLORS.Surface
    ButtonFrame.BorderSizePixel = 0
    ButtonFrame.Text = ""
    ButtonFrame.AutoButtonColor = false
    ButtonFrame.Parent = Button
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 8)
    ButtonCorner.Parent = ButtonFrame
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, -40, description == "" and 1 or 0.5, 0)
    Label.Position = UDim2.new(0, 12, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = COLORS.White
    Label.TextSize = 12
    Label.Font = Enum.Font.GothamBold
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = ButtonFrame
    
    if description ~= "" then
        local DescLabel = Instance.new("TextLabel")
        DescLabel.Size = UDim2.new(1, -40, 0.5, 0)
        DescLabel.Position = UDim2.new(0, 12, 0.5, 0)
        DescLabel.BackgroundTransparency = 1
        DescLabel.Text = description
        DescLabel.TextColor3 = COLORS.Gray
        DescLabel.TextSize = 9
        DescLabel.Font = Enum.Font.Gotham
        DescLabel.TextXAlignment = Enum.TextXAlignment.Left
        DescLabel.TextYAlignment = Enum.TextYAlignment.Top
        DescLabel.Parent = ButtonFrame
    end
    
    local Arrow = Instance.new("ImageLabel")
    Arrow.Size = UDim2.new(0, 12, 0, 12)
    Arrow.Position = UDim2.new(1, -24, description == "" and 0.5 or 0.25, -6)
    Arrow.BackgroundTransparency = 1
    Arrow.Image = ICONS.waves
    Arrow.ImageColor3 = COLORS.Icon
    Arrow.Rotation = -90
    Arrow.Parent = ButtonFrame
    
    ButtonFrame.MouseButton1Click:Connect(function()
        if self.AnimationsEnabled then
            TweenService:Create(ButtonFrame, TweenInfo.new(0.06), {Size = UDim2.new(0.98, 0, 0.92, 0)}):Play()
            TweenService:Create(Arrow, TweenInfo.new(0.06), {Position = UDim2.new(1, -22, description == "" and 0.5 or 0.25, -6)}):Play()
            wait(0.06)
            TweenService:Create(ButtonFrame, TweenInfo.new(0.06), {Size = UDim2.new(1, 0, 1, 0)}):Play()
            TweenService:Create(Arrow, TweenInfo.new(0.06), {Position = UDim2.new(1, -24, description == "" and 0.5 or 0.25, -6)}):Play()
        end
        
        if self.SoundsEnabled then
            PlaySound("rbxassetid://124782754699900")
        end
        
        if callback then
            callback()
        end
    end)
    
    ButtonFrame.MouseEnter:Connect(function()
        TweenService:Create(ButtonFrame, FAST_TWEEN, {BackgroundColor3 = COLORS.Accent}):Play()
        TweenService:Create(Arrow, FAST_TWEEN, {ImageColor3 = Color3.fromRGB(15, 15, 20)}):Play()
        TweenService:Create(Label, FAST_TWEEN, {TextColor3 = Color3.fromRGB(15, 15, 20)}):Play()
    end)
    
    ButtonFrame.MouseLeave:Connect(function()
        TweenService:Create(ButtonFrame, FAST_TWEEN, {BackgroundColor3 = COLORS.Surface}):Play()
        TweenService:Create(Arrow, FAST_TWEEN, {ImageColor3 = COLORS.Icon}):Play()
        TweenService:Create(Label, FAST_TWEEN, {TextColor3 = COLORS.White}):Play()
    end)
    
    table.insert(self.AccentElements, ButtonFrame)
    
    return Button
end

function ModernUI:Notify(config)
    config = config or {}
    local title = config.Title or "Notification"
    local body = config.Body or "Message"
    local icon = config.Icon or ICONS.notify
    local duration = config.Duration or 5
    
    if self.SoundsEnabled then
        PlaySound("rbxassetid://112599788324904")
    end
    
    local Notification = Instance.new("Frame")
    Notification.Name = "Notification"
    Notification.Size = UDim2.new(0, 320, 0, 90)
    Notification.Position = UDim2.new(1, 0, 1, -100)
    Notification.BackgroundColor3 = COLORS.Surface
    Notification.BorderSizePixel = 0
    Notification.Parent = self.ScreenGui
    
    local NotifCorner = Instance.new("UICorner")
    NotifCorner.CornerRadius = UDim.new(0, 10)
    NotifCorner.Parent = Notification
    
    local IconLabel = Instance.new("ImageLabel")
    IconLabel.Size = UDim2.new(0, 32, 0, 32)
    IconLabel.Position = UDim2.new(0, 16, 0, 16)
    IconLabel.BackgroundTransparency = 1
    IconLabel.ImageColor3 = COLORS.Accent
    IconLabel.Parent = Notification
    
    AnimateIcon(IconLabel, icon, 0.1)
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -64, 0, 20)
    TitleLabel.Position = UDim2.new(0, 56, 0, 16)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title
    TitleLabel.TextColor3 = COLORS.White
    TitleLabel.TextSize = 13
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.TextWrapped = true
    TitleLabel.Parent = Notification
    
    local BodyLabel = Instance.new("TextLabel")
    BodyLabel.Size = UDim2.new(1, -64, 0, 32)
    BodyLabel.Position = UDim2.new(0, 56, 0, 38)
    BodyLabel.BackgroundTransparency = 1
    BodyLabel.Text = body
    BodyLabel.TextColor3 = COLORS.Gray
    BodyLabel.TextSize = 11
    BodyLabel.Font = Enum.Font.Gotham
    BodyLabel.TextXAlignment = Enum.TextXAlignment.Left
    BodyLabel.TextYAlignment = Enum.TextYAlignment.Top
    BodyLabel.TextWrapped = true
    BodyLabel.Parent = Notification
    
    local LoadingBar = Instance.new("Frame")
    LoadingBar.Size = UDim2.new(1, 0, 0, 2)
    LoadingBar.Position = UDim2.new(0, 0, 1, -2)
    LoadingBar.BackgroundColor3 = COLORS.Accent
    LoadingBar.BorderSizePixel = 0
    LoadingBar.Parent = Notification
    
    local LoadingBarCorner = Instance.new("UICorner")
    LoadingBarCorner.CornerRadius = UDim.new(0, 1)
    LoadingBarCorner.Parent = LoadingBar
    
    local tweenIn = TweenService:Create(Notification, TWEEN_INFO, {Position = UDim2.new(1, -336, 1, -100)})
    tweenIn:Play()
    
    local tweenBar = TweenService:Create(LoadingBar, TweenInfo.new(duration, Enum.EasingStyle.Linear), {Size = UDim2.new(0, 0, 0, 2)})
    tweenBar:Play()
    
    task.delay(duration, function()
        local tweenOut = TweenService:Create(Notification, TWEEN_INFO, {Position = UDim2.new(1, 0, 1, -100)})
        tweenOut:Play()
        tweenOut.Completed:Connect(function()
            Notification:Destroy()
        end)
    end)
end

function ModernUI:CreateFloatingButton(config)
    config = config or {}
    
    local size = config.Size or 50
    local icon = config.Icon or self.Icon
    local position = config.Position or UDim2.new(1, -66, 0.5, -25)
    
    local Button = Instance.new("ImageButton")
    Button.Name = "FloatingButton"
    Button.Size = UDim2.new(0, size, 0, size)
    Button.Position = position
    Button.BackgroundTransparency = 1
    Button.ImageColor3 = COLORS.Accent
    Button.AutoButtonColor = false
    Button.ZIndex = 9999
    Button.Parent = self.ScreenGui
    
    AnimateIcon(Button, icon, 0.1)
    
    self.FloatingButton = Button
    self.FloatingButtonIcon = icon
    
    if self.ConfigData.FloatingButton.Position then
        Button.Position = self.ConfigData.FloatingButton.Position
    end
    
    self:MakeDraggable(Button, Button)
    
    Button.MouseButton1Click:Connect(function()
        if self.SoundsEnabled then
            PlaySound("rbxassetid://124782754699900")
        end
        self.MainFrame.Visible = not self.MainFrame.Visible
    end)
    
    Button.MouseEnter:Connect(function()
        TweenService:Create(Button, FAST_TWEEN, {
            Size = UDim2.new(0, size + 4, 0, size + 4),
            ImageColor3 = Color3.new(
                COLORS.Accent.R * 0.8,
                COLORS.Accent.G * 0.8,
                COLORS.Accent.B * 0.8
            )
        }):Play()
    end)
    
    Button.MouseLeave:Connect(function()
        TweenService:Create(Button, FAST_TWEEN, {
            Size = UDim2.new(0, size, 0, size),
            ImageColor3 = COLORS.Accent
        }):Play()
    end)
    
    Button:GetPropertyChangedSignal("Position"):Connect(function()
        self.ConfigData.FloatingButton.Position = Button.Position
        self:SaveConfig()
    end)
    
    return Button
end

function ModernUI:SetIcon(iconId)
    self.Icon = iconId
    if self.IconFrame then
        AnimateIcon(self.IconFrame, iconId, self.IconFPS)
    end
    if self.FloatingButton then
        AnimateIcon(self.FloatingButton, iconId, self.IconFPS)
    end
end

function ModernUI:SaveConfig()
    if not self.SaveFolder then return end
    
    self.ConfigData.Theme = self.CurrentTheme
    self.ConfigData.Acrylic = self.AcrylicEnabled
    self.ConfigData.MinimizeKey = self.MinimizeKey.Name
    self.ConfigData.BackgroundImage = self.BackgroundImage
    self.ConfigData.BackgroundTransparency = self.BackgroundTransparency
    self.ConfigData.SoundsEnabled = self.SoundsEnabled
    self.ConfigData.AnimationsEnabled = self.AnimationsEnabled
    self.ConfigData.RoundedCorners = self.RoundedCorners
    
    local success, err = pcall(function()
        local json = HttpService:JSONEncode(self.ConfigData)
        if writefile then
            writefile(self.SaveFolder .. ".json", json)
        end
    end)
end

function ModernUI:LoadConfig()
    if not self.SaveFolder then return end
    
    local success, err = pcall(function()
        if readfile and isfile(self.SaveFolder .. ".json") then
            local json = readfile(self.SaveFolder .. ".json")
            self.ConfigData = HttpService:JSONDecode(json)
            
            if not self.ConfigData.Toggles then self.ConfigData.Toggles = {} end
            if not self.ConfigData.Dropdowns then self.ConfigData.Dropdowns = {} end
            if not self.ConfigData.MultiDropdowns then self.ConfigData.MultiDropdowns = {} end
            if not self.ConfigData.Sliders then self.ConfigData.Sliders = {} end
            if not self.ConfigData.FloatingButton then self.ConfigData.FloatingButton = {} end
            if not self.ConfigData.CustomThemes then self.ConfigData.CustomThemes = {} end
            
            if self.ConfigData.Theme then
                self.CurrentTheme = self.ConfigData.Theme
                if self.ConfigData.Theme == "Custom" and self.ConfigData.CustomThemeColor then
                    local color = self.ConfigData.CustomThemeColor
                    COLORS.Accent = Color3.fromRGB(color[1] * 255, color[2] * 255, color[3] * 255)
                end
            end
            
            if self.ConfigData.Acrylic ~= nil then
                self.AcrylicEnabled = self.ConfigData.Acrylic
            end
            
            if self.ConfigData.MinimizeKey then
                local keyName = self.ConfigData.MinimizeKey
                for _, key in pairs(Enum.KeyCode:GetEnumItems()) do
                    if key.Name == keyName then
                        self.MinimizeKey = key
                        break
                    end
                end
            end
            
            if self.ConfigData.BackgroundImage then
                self.BackgroundImage = self.ConfigData.BackgroundImage
            end
            
            if self.ConfigData.BackgroundTransparency then
                self.BackgroundTransparency = self.ConfigData.BackgroundTransparency
            end
            
            if self.ConfigData.SoundsEnabled ~= nil then
                self.SoundsEnabled = self.ConfigData.SoundsEnabled
            end
            
            if self.ConfigData.AnimationsEnabled ~= nil then
                self.AnimationsEnabled = self.ConfigData.AnimationsEnabled
            end
            
            if self.ConfigData.RoundedCorners ~= nil then
                self.RoundedCorners = self.ConfigData.RoundedCorners
            end
        end
    end)
end

return ModernUI
